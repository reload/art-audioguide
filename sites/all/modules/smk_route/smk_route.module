<?php
/**
 * @file
 * Code for the  feature.
 */

include_once 'smk_route.features.inc';

/**
 * Implements hook_ds_fields_info().
 */
function smk_route_ds_fields_info($entity_type) {
  $fields = array();

  if ($entity_type == 'node') {
    // Amount of referenced sounds.
    $fields['node']['amount_of_sounds'] = array(
        'title' => t('Amount of sounds'),
        'field_type' => DS_FIELD_TYPE_FUNCTION,
        'function' => '_smk_route_amount_of_sounds',
        'ui_limit' => array('route|*'),
    );
        'ui_limit' => array('route|*'),
    );
  }

  if (isset($fields[$entity_type])) {
    return array($entity_type => $fields[$entity_type]);
  }

  return;
}

/**
 * Returns the amount of sounds a route references.
 */
function _smk_route_amount_of_sounds($field) {
  // Set query to get the amount of references.
  $query = db_query("SELECT COUNT(field_audio_ref_target_id) FROM field_data_field_audio_ref WHERE entity_id = :nid", array(
    'nid' => $field['entity']->nid,
  ));
  // Get the result as a string.
  $result = $query->fetchField();

  // Return the string.
  return format_plural($result, t('!result sound'), t('!result sounds'), array('!result' => $result));
}
}
